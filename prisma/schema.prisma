generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema", "views"]
}

generator json {
  provider = "prisma-json-types-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["admin", "main", "min", "reference"]
}

model GroupementRecord {
  id Int @id @default(autoincrement())

  nom String

  utilisateurs UtilisateurRecord[]

  @@map("groupement")
  @@schema("min")
}

model DepartementRecord {
  code       String @id
  regionCode String @map("region_code")
  nom        String

  structures   StructureRecord[]
  utilisateurs UtilisateurRecord[]

  relationRegion         RegionRecord                 @relation(fields: [regionCode], references: [code])
  gouvernances           GouvernanceRecord[]
  departementsEnveloppes DepartementEnveloppeRecord[]

  @@map("departement")
  @@schema("min")
}

model RegionRecord {
  code String @id
  nom  String

  departements DepartementRecord[]
  utilisateurs UtilisateurRecord[]

  @@map("region")
  @@schema("min")
}

model StructureRecord {
  id Int @id @default(autoincrement())

  adresse                  String
  codePostal               String  @map("code_postal")
  commune                  String
  /// [Contact]
  contact                  Json
  departementCode          String  @map("departement_code")
  // SIRET ou RIDET
  identifiantEtablissement String  @map("identifiant_etablissement")
  // TODO: à supprimer après la migration finale
  idMongo                  String  @map("id_mongo")
  nom                      String  @db.Citext
  statut                   String
  type                     String
  categorieJuridique       String? @map("categorie_juridique") @db.VarChar(4)

  relationDepartement DepartementRecord @relation(fields: [departementCode], references: [code])

  @@map("structure")
  @@schema("min")
}

model UtilisateurRecord {
  id Int @id @default(autoincrement())

  dateDeCreation    DateTime  @map("date_de_creation")
  departementCode   String?   @map("departement_code")
  derniereConnexion DateTime? @map("derniere_connexion")
  emailDeContact    String    @map("email_de_contact")
  groupementId      Int?      @map("groupement_id")
  inviteLe          DateTime  @map("invite_le")
  isSuperAdmin      Boolean   @default(false) @map("is_super_admin")
  isSupprime        Boolean   @default(false) @map("is_supprime")
  nom               String    @db.Citext
  prenom            String
  regionCode        String?   @map("region_code")
  role              Role
  oldStructureId    Int?      @map("old_structure_id")
  structureId       Int?      @map("structure_id")
  ssoId             String    @unique @default("") @map("sso_id")
  ssoEmail          String    @unique @map("sso_email")
  telephone         String    @db.VarChar(13)

  relationStructure   main_structure?    @relation(fields: [structureId], onDelete: NoAction, onUpdate: NoAction, references: [id])
  relationGroupement  GroupementRecord?  @relation(fields: [groupementId], references: [id])
  relationDepartement DepartementRecord? @relation(fields: [departementCode], references: [code])
  relationRegion      RegionRecord?      @relation(fields: [regionCode], references: [code])

  comites                   ComiteRecord[]
  notesPrivees              GouvernanceRecord[]         @relation("UtilisateurNotesPrivees")
  noteDeContexte            GouvernanceRecord[]         @relation("UtilisateurnoteDeContexte")
  actionRecord              ActionRecord[]
  demandeDeSubventionRecord DemandeDeSubventionRecord[]
  FeuilleDeRouteRecord      FeuilleDeRouteRecord[]

  @@map("utilisateur")
  @@schema("min")
}

model GouvernanceRecord {
  departementCode               String    @id @map("departement_code")
  /// [NotePrivee]
  notePrivee                    Json?     @map("note_privee")
  editeurNotePriveeId           String?   @map("editeur_note_privee_id")
  noteDeContexte                String?   @map("note_de_contexte")
  editeurNoteDeContexteId       String?   @map("editeur_note_de_contexte_id")
  derniereEditionNoteDeContexte DateTime? @map("derniere_edition_note_de_contexte")

  relationDepartement           DepartementRecord  @relation(fields: [departementCode], references: [code])
  relationEditeurNotePrivee     UtilisateurRecord? @relation("UtilisateurNotesPrivees", fields: [editeurNotePriveeId], references: [ssoId])
  relationEditeurNoteDeContexte UtilisateurRecord? @relation("UtilisateurnoteDeContexte", fields: [editeurNoteDeContexteId], references: [ssoId])

  comites         ComiteRecord[]
  feuillesDeRoute FeuilleDeRouteRecord[]
  membres         MembreRecord[]

  @@map("gouvernance")
  @@schema("min")
}

model ComiteRecord {
  id Int @id @default(autoincrement())

  gouvernanceDepartementCode String    @map("gouvernance_departement_code")
  creation                   DateTime
  derniereEdition            DateTime  @map("derniere_edition")
  type                       String
  frequence                  String
  commentaire                String?
  date                       DateTime?
  editeurUtilisateurId       String    @map("editeur_utilisateur_id")

  relationUtilisateur UtilisateurRecord @relation(fields: [editeurUtilisateurId], references: [ssoId])
  relationGouvernance GouvernanceRecord @relation(fields: [gouvernanceDepartementCode], references: [departementCode])

  @@map("comite")
  @@schema("min")
}

model FeuilleDeRouteRecord {
  id Int @id @default(autoincrement())

  gouvernanceDepartementCode String    @map("gouvernance_departement_code")
  creation                   DateTime
  derniereEdition            DateTime? @map("derniere_edition")
  nom                        String
  noteDeContextualisation    String?   @map("note_de_contextualisation")
  pieceJointe                String?   @map("piece_jointe")
  porteurId                  String?   @map("porteur_id")
  editeurUtilisateurId       String?   @map("editeur_utilisateur_id")
  perimetreGeographique      String?   @map("perimetre_geographique")

  oldUUID String? @map("old_uuid") @db.Uuid

  relationUtilisateur UtilisateurRecord? @relation(fields: [editeurUtilisateurId], references: [ssoId])
  relationGouvernance GouvernanceRecord  @relation(fields: [gouvernanceDepartementCode], references: [departementCode])
  relationMembre      MembreRecord?      @relation(fields: [porteurId], references: [id])
  action              ActionRecord[]

  @@map("feuille_de_route")
  @@schema("min")
}

model ContactMembreGouvernanceRecord {
  email String @id

  prenom   String
  nom      String
  fonction String

  membresContact          MembreRecord[] @relation("contact")
  membresContactTechnique MembreRecord[] @relation("contactTechnique")

  @@map("contact_membre_gouvernance")
  @@schema("min")
}

model MembreRecord {
  id String @id

  gouvernanceDepartementCode String    @map("gouvernance_departement_code")
  contact                    String
  contactTechnique           String?   @map("contact_technique")
  type                       String?
  statut                     String
  isCoporteur                Boolean   @default(false) @map("is_coporteur")
  categorieMembre            String?   @map("categorie_membre")
  nom                        String?   @map("nom")
  siretRidet                 String?   @map("siret_ridet")
  dateSuppression            DateTime? @map("date_suppression")
  oldStructureId             Int?      @map("old_structure_id")
  structureId                Int?      @map("structure_id")

  oldUUID String @map("old_uuid") @db.Uuid

  relationGouvernance      GouvernanceRecord               @relation(fields: [gouvernanceDepartementCode], references: [departementCode])
  relationContact          ContactMembreGouvernanceRecord  @relation("contact", fields: [contact], references: [email])
  relationContactTechnique ContactMembreGouvernanceRecord? @relation("contactTechnique", fields: [contactTechnique], references: [email])
  relationStructure        main_structure?                 @relation(fields: [structureId], onDelete: NoAction, onUpdate: NoAction, references: [id])

  FeuilleDeRouteRecord         FeuilleDeRouteRecord[]
  BeneficiaireSubventionRecord BeneficiaireSubventionRecord[]
  PorteurActionRecord          PorteurActionRecord[]
  CoFinancementRecord          CoFinancementRecord[]

  @@map("membre")
  @@schema("min")
}

model ActionRecord {
  id           Int      @id @default(autoincrement())
  besoins      String[]
  createurId   Int      @map("createur_id")
  nom          String
  contexte     String
  description  String
  budgetGlobal Float    @map("budget_global")

  feuilleDeRouteId Int      @map("feuille_de_route_id")
  dateDeDebut      DateTime @map("date_de_debut")
  dateDeFin        DateTime @map("date_de_fin")

  creation             DateTime @map("creation")
  derniereModification DateTime @map("derniere_modification")

  utilisateur          UtilisateurRecord           @relation(fields: [createurId], references: [id])
  feuilleDeRoute       FeuilleDeRouteRecord        @relation(fields: [feuilleDeRouteId], references: [id])
  demandesDeSubvention DemandeDeSubventionRecord[]
  porteurAction        PorteurActionRecord[]
  coFinancement        CoFinancementRecord[]

  @@map("action")
  @@schema("min")
}

model DemandeDeSubventionRecord {
  id                     Int    @id @default(autoincrement())
  createurId             Int    @map("createur_id")
  statut                 String
  subventionDemandee     Float  @map("subvention_demandee")
  subventionEtp          Float? @map("subvention_etp")
  subventionPrestation   Float? @map("subvention_prestation")
  actionId               Int    @unique @map("action_id")
  enveloppeFinancementId Int    @map("enveloppe_financement_id")

  creation             DateTime @map("creation")
  derniereModification DateTime @map("derniere_modification")

  utilisateur  UtilisateurRecord              @relation(fields: [createurId], references: [id])
  action       ActionRecord                   @relation(fields: [actionId], references: [id])
  enveloppe    EnveloppeFinancementRecord     @relation(fields: [enveloppeFinancementId], references: [id])
  beneficiaire BeneficiaireSubventionRecord[]

  @@map("demande_de_subvention")
  @@schema("min")
}

model BeneficiaireSubventionRecord {
  demandeDeSubventionId Int    @map("demande_de_subvention_id")
  membreId              String @map("membre_id")

  demandeDeSubvention DemandeDeSubventionRecord @relation(fields: [demandeDeSubventionId], references: [id])
  membre              MembreRecord              @relation(fields: [membreId], references: [id])

  @@id([demandeDeSubventionId, membreId])
  @@map("beneficiaire_subvention")
  @@schema("min")
}

model PorteurActionRecord {
  actionId Int    @map("action_id")
  membreId String @map("membre_id")

  action ActionRecord @relation(fields: [actionId], references: [id])
  membre MembreRecord @relation(fields: [membreId], references: [id])

  @@id([actionId, membreId])
  @@map("porteur_action")
  @@schema("min")
}

model EnveloppeFinancementRecord {
  id          Int      @id @default(autoincrement())
  libelle     String
  dateDeDebut DateTime @map("date_debut")
  dateDeFin   DateTime @map("date_fin")
  montant     Float

  demandesDeSubvention   DemandeDeSubventionRecord[]
  departementsEnveloppes DepartementEnveloppeRecord[]

  @@map("enveloppe_financement")
  @@schema("min")
}

model CoFinancementRecord {
  id       Int    @id @default(autoincrement())
  actionId Int    @map("id_action")
  memberId String @map("id_membre")
  montant  Float

  action ActionRecord @relation(fields: [actionId], references: [id])
  membre MembreRecord @relation(fields: [memberId], references: [id])

  @@map("co_financement")
  @@schema("min")
}

model DepartementEnveloppeRecord {
  departementCode String @map("departement_code")
  enveloppeId     Int    @map("enveloppe_id")
  plafond         Float

  relationDepartement DepartementRecord          @relation(fields: [departementCode], references: [code])
  relationEnveloppe   EnveloppeFinancementRecord @relation(fields: [enveloppeId], references: [id])

  @@id([departementCode, enveloppeId])
  @@map("departement_enveloppe")
  @@schema("min")
}

enum Role {
  administrateur_dispositif
  gestionnaire_departement
  gestionnaire_groupement
  gestionnaire_region
  gestionnaire_structure

  @@schema("min")
}

/// Vue enrichie de la table personne avec typage des accompagnateurs
/// Cette vue est créée par la migration 20250828071256_creation_vue_personne_enrichie
view PersonneEnrichieView {
  id                      Int       @unique
  prenom                  String?   @db.VarChar(50)
  nom                     String?   @db.VarChar(50)
  contact                 Json?
  structure_id            Int?
  aidant_connect_id       Int?
  conseiller_numerique_id String?   @db.VarChar(50)
  cn_pg_id                Int?
  coop_id                 String?   @db.Uuid
  is_coordinateur         Boolean?
  is_mediateur            Boolean?
  is_active_ac            Boolean?
  formation_fne_ac        Boolean?
  profession_ac           String?   @db.VarChar
  nb_accompagnements_ac   Int?
  created_at              DateTime? @db.Timestamp(6)
  updated_at              DateTime? @db.Timestamp(6)

  // Colonnes calculées de la vue
  type_accompagnateur                        String   @db.VarChar
  labellisation_aidant_connect               Boolean?
  est_actuellement_mediateur_en_poste        Boolean
  est_actuellement_aidant_numerique_en_poste Boolean
  est_actuellement_conseiller_numerique      Boolean
  est_actuellement_coordo_actif              Boolean
  structure_employeuse_id                    Int?

  @@map("personne_enrichie")
  @@schema("min")
}

model commune {
  id             Int                     @id @default(autoincrement())
  geom           Unsupported("geometry")
  departement_id Int
  statut         String?                 @db.VarChar(24)
  code_insee     String                  @unique(map: "commune_ukey") @db.VarChar(5)
  nom            String                  @db.VarChar(50)
  population     Int?
  created_at     DateTime?               @default(now()) @db.Timestamp(6)
  updated_at     DateTime?               @db.Timestamp(6)
  code_insee_cr  String?                 @db.VarChar(5)
  departement    admin_departement       @relation(fields: [departement_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "commune_departement_id")
  commune_epci   commune_epci[]
  zonage         zonage[]

  @@index([geom], type: Gist)
  @@index([nom])
  @@schema("admin")
}

model commune_epci {
  id         Int       @id @default(autoincrement())
  commune_id Int
  epci_id    Int
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)
  commune    commune   @relation(fields: [commune_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "commune_epci_commune_id")
  epci       epci      @relation(fields: [epci_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "commune_epci_epci_id")

  @@unique([commune_id, epci_id], map: "commune_epci_ukey")
  @@schema("admin")
}

model admin_departement {
  id         Int                     @id @default(autoincrement())
  geom       Unsupported("geometry")
  region_id  Int
  code       String                  @unique(map: "departement_ukey") @db.VarChar(3)
  nom        String                  @db.VarChar(30)
  created_at DateTime?               @default(now()) @db.Timestamp(6)
  updated_at DateTime?               @db.Timestamp(6)
  commune    commune[]
  region     admin_region            @relation(fields: [region_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "departement_region_id")

  @@map("departement")
  @@schema("admin")
}

model epci {
  id           Int                     @id @default(autoincrement())
  geom         Unsupported("geometry")
  code         String                  @unique(map: "epci_ukey") @db.VarChar(9)
  type         String                  @db.VarChar(32)
  nom          String                  @db.VarChar(90)
  created_at   DateTime?               @default(now()) @db.Timestamp(6)
  updated_at   DateTime?               @db.Timestamp(6)
  commune_epci commune_epci[]

  @@schema("admin")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model IfnCommune {
  id         Int       @id @default(autoincrement())
  codeInsee  String    @unique(map: "ifn_commune_ukey") @map("code_insee") @db.VarChar(5)
  score      Decimal   @db.Decimal
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)

  @@index([codeInsee])
  @@map("ifn_commune")
  @@schema("admin")
}

model insee_cp {
  id          Int       @id @default(autoincrement())
  code_insee  String    @db.VarChar(5)
  code_postal String    @db.VarChar(5)
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @db.Timestamp(6)

  @@unique([code_postal, code_insee], map: "insee_cp_ukey")
  @@schema("admin")
}

model insee_historique {
  id                 Int       @id @default(autoincrement())
  code_insee_ancien  String    @db.VarChar(5)
  code_insee_nouveau String    @db.VarChar(5)
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  updated_at         DateTime? @db.Timestamp(6)

  @@unique([code_insee_ancien, code_insee_nouveau], map: "insee_historique_ukey")
  @@schema("admin")
}

model admin_region {
  id          Int                     @id @default(autoincrement())
  geom        Unsupported("geometry")
  code        String                  @unique(map: "region_ukey") @db.VarChar(2)
  nom         String                  @db.VarChar(35)
  created_at  DateTime?               @default(now()) @db.Timestamp(6)
  updated_at  DateTime?               @db.Timestamp(6)
  departement admin_departement[]

  @@map("region")
  @@schema("admin")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model zonage {
  id          Int                      @id @default(autoincrement())
  geom        Unsupported("geometry")?
  code        String?                  @db.VarChar(8)
  libelle     String?                  @db.VarChar(255)
  code_insee  String                   @db.VarChar(5)
  type        String                   @db.VarChar(3)
  commentaire String?
  created_at  DateTime?                @default(now()) @db.Timestamp(6)
  updated_at  DateTime?                @db.Timestamp(6)
  commune     commune                  @relation(fields: [code_insee], references: [code_insee], onDelete: NoAction, onUpdate: NoAction)

  @@unique([code, code_insee], map: "zonage_code_ukey")
  @@index([code_insee])
  @@index([geom], type: Gist)
  @@schema("admin")
}

model activites_coop {
  id                                  Int             @id @default(autoincrement())
  coop_id                             String?         @unique(map: "activites_coop_coop_id_ukey") @db.Uuid
  structure_id                        Int?
  personne_id                         Int?
  type                                String          @db.VarChar(100)
  date                                DateTime        @db.Date
  duree                               Int
  lieu_code_insee                     String?         @db.VarChar(5)
  type_lieu                           String          @db.VarChar(100)
  autonomie                           String?         @db.VarChar(100)
  structure_de_redirection            String?         @db.VarChar(255)
  oriente_vers_structure              Boolean?
  precisions_demarche                 String?
  degre_de_finalisation_demarche      String?         @db.VarChar(50)
  titre_atelier                       String?         @db.VarChar(255)
  niveau_atelier                      String?         @db.VarChar(50)
  accompagnements                     Int             @default(0)
  thematiques                         String[]
  materiels                           String[]
  thematiques_demarche_administrative String[]
  created_at                          DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                          DateTime?       @db.Timestamp(6)
  periode                             DateTime?       @default(dbgenerated("(date_trunc('month'::text, (date)::timestamp without time zone))::date")) @db.Date
  personne                            personne?       @relation(fields: [personne_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "activites_coop_personne_id_fkey")
  structure                           main_structure? @relation(fields: [structure_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([lieu_code_insee])
  @@index([periode])
  @@index([personne_id])
  @@schema("main")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model adresse {
  id           Int                      @id @default(autoincrement())
  geom         Unsupported("geometry")?
  clef_interop String?                  @db.VarChar(50)
  code_ban     String?                  @unique(map: "adresse_code_ban_ukey") @db.Uuid
  code_postal  String                   @db.VarChar(5)
  code_insee   String                   @db.VarChar(5)
  nom_commune  String                   @db.VarChar(255)
  nom_voie     String?                  @db.VarChar(255)
  repetition   String?                  @db.VarChar(10)
  numero_voie  Int?                     @db.SmallInt
  created_at   DateTime?                @default(now()) @db.Timestamp(6)
  updated_at   DateTime?                @db.Timestamp(6)
  departement  String?                  @default(dbgenerated("\nCASE\n    WHEN (((code_insee)::text ~ '^97'::text) OR ((code_insee)::text ~ '^98'::text)) THEN \"left\"((code_insee)::text, 3)\n    ELSE \"left\"((code_insee)::text, 2)\nEND")) @db.VarChar(3)
  structure    main_structure[]

  @@index([geom], type: Gist)
  @@index([code_insee])
  @@schema("main")
}

model coordination_mediation {
  id                                                             Int       @id @default(autoincrement())
  coordinateur_id                                                Int
  mediateur_id                                                   Int
  coordinateur_coop_id                                           String    @db.Uuid
  mediateur_coop_id                                              String    @db.Uuid
  en_cours                                                       Boolean?
  created_at                                                     DateTime? @default(now()) @db.Timestamp(6)
  updated_at                                                     DateTime? @db.Timestamp(6)
  personne_coordination_mediation_coordinateur_idTopersonne      personne  @relation("coordination_mediation_coordinateur_idTopersonne", fields: [coordinateur_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "coordination_mediation_coodinateur_id_fkey")
  personne_coordination_mediation_coordinateur_coop_idTopersonne personne  @relation("coordination_mediation_coordinateur_coop_idTopersonne", fields: [coordinateur_coop_id], references: [coop_id], onDelete: NoAction, onUpdate: NoAction)
  personne_coordination_mediation_mediateur_coop_idTopersonne    personne  @relation("coordination_mediation_mediateur_coop_idTopersonne", fields: [mediateur_coop_id], references: [coop_id], onDelete: NoAction, onUpdate: NoAction)
  personne_coordination_mediation_mediateur_idTopersonne         personne  @relation("coordination_mediation_mediateur_idTopersonne", fields: [mediateur_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "coordination_mediation_mediateur_id_fkey")

  @@schema("main")
}

model personne {
  id                                                                           Int                      @id @default(autoincrement())
  prenom                                                                       String?                  @db.VarChar(50)
  nom                                                                          String?                  @db.VarChar(50)
  contact                                                                      Json?
  aidant_connect_id                                                            Int?                     @unique(map: "personne_aidant_connect_id_ukey")
  conseiller_numerique_id                                                      String?                  @unique(map: "personne_conseiller_numerique_id_ukey") @db.VarChar(50)
  cn_pg_id                                                                     Int?                     @unique(map: "personne_cn_pg_id_ukey")
  coop_id                                                                      String?                  @unique(map: "personne_coop_id_ukey") @db.Uuid
  is_coordinateur                                                              Boolean?
  is_mediateur                                                                 Boolean?
  is_active_ac                                                                 Boolean?
  formation_fne_ac                                                             Boolean?
  profession_ac                                                                String?                  @db.VarChar
  nb_accompagnements_ac                                                        Int?
  created_at                                                                   DateTime?                @default(now()) @db.Timestamp(6)
  updated_at                                                                   DateTime?                @db.Timestamp(6)
  edited_by                                                                    String?                  @db.VarChar(50)
  activites_coop                                                               activites_coop[]
  contrat                                                                      contrat[]
  coordination_mediation_coordination_mediation_coordinateur_idTopersonne      coordination_mediation[] @relation("coordination_mediation_coordinateur_idTopersonne")
  coordination_mediation_coordination_mediation_coordinateur_coop_idTopersonne coordination_mediation[] @relation("coordination_mediation_coordinateur_coop_idTopersonne")
  coordination_mediation_coordination_mediation_mediateur_coop_idTopersonne    coordination_mediation[] @relation("coordination_mediation_mediateur_coop_idTopersonne")
  coordination_mediation_coordination_mediation_mediateur_idTopersonne         coordination_mediation[] @relation("coordination_mediation_mediateur_idTopersonne")
  formation                                                                    formation[]
  personne_affectations                                                        personne_affectations[]
  poste                                                                        poste[]

  @@index([nom, prenom], map: "personne_patronyme")
  @@schema("main")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model poste {
  id                  Int             @id @default(autoincrement())
  poste_conum_id      Int
  structure_id        Int?
  personne_id         Int?
  typologie           String?         @db.VarChar(6)
  date_attribution    DateTime        @db.Date
  date_rendu_poste    DateTime?       @db.Date
  poste_renouvele     Boolean?
  action_coselec      String?         @db.VarChar(255)
  origine_transfert   Int?
  etat                String?         @db.VarChar(6)
  created_at          DateTime?       @default(now()) @db.Timestamp(6)
  updated_at          DateTime?       @db.Timestamp(6)
  etat_instruction_v1 String?         @db.VarChar
  etat_instruction_v2 String?         @db.VarChar
  personne            personne?       @relation(fields: [personne_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  structure           main_structure? @relation(fields: [structure_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subvention          subvention[]

  @@unique([poste_conum_id, structure_id, personne_id], map: "poste_ukey")
  @@schema("main")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model main_structure {
  id                                  Int                     @id @default(autoincrement())
  structure_coop_id                   String?                 @unique(map: "structure_structure_coop_id_ukey") @db.Uuid
  structure_ac_id                     String?                 @unique(map: "structure_structure_ac_id_ukey") @db.Uuid
  structure_tp_id                     Int?                    @unique(map: "structure_structure_tp_id_ukey")
  nom                                 String                  @db.VarChar(255)
  denomination_sirene                 String?                 @db.VarChar
  siret                               String?                 @db.VarChar(14)
  rna                                 String?                 @db.VarChar(10)
  adresse_id                          Int?
  contact                             Json?
  etat_administratif                  String?                 @db.VarChar
  code_activite_principale            String?                 @db.VarChar(6)
  categorie_juridique                 String?                 @db.VarChar(4)
  nb_mandats_ac                       Int?
  publique                            Boolean?
  structure_cartographie_nationale_id String?                 @unique(map: "structure_cartographie_ukey") @db.VarChar
  visible_pour_cartographie_nationale Boolean?
  typologies                          String[]
  presentation_resume                 String?
  presentation_detail                 String?
  horaires                            String?                 @db.VarChar
  prise_rdv                           String?                 @db.VarChar
  structure_parente                   String?                 @db.Uuid
  services                            String[]
  publics_specifiquement_adresses     String[]
  prise_en_charge_specifique          String[]
  frais_a_charge                      String[]
  dispositif_programmes_nationaux     String[]
  formations_labels                   String[]
  autres_formations_labels            String[]
  itinerance                          String[]
  modalites_acces                     String[]
  modalites_accompagnement            String[]
  mediateurs_en_activite              Int?
  emplois                             Int?
  source                              String?                 @db.VarChar
  last_sirene_enrich_at               DateTime?               @db.Date
  created_at                          DateTime?               @default(now()) @db.Timestamp(6)
  updated_at                          DateTime?               @db.Timestamp(6)
  fiche_acces_libre                   String?                 @db.VarChar
  edited_by                           String?                 @db.VarChar(50)
  activites_coop                      activites_coop[]
  personne_affectations               personne_affectations[]
  poste                               poste[]
  adresse                             adresse?                @relation(fields: [adresse_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "structure_adresse_fkey")
  categories_juridiques               categories_juridiques?  @relation(fields: [categorie_juridique], references: [code], onDelete: NoAction, onUpdate: NoAction, map: "structure_categorie_juridique_fkey")
  membres                             MembreRecord[]
  utilisateurs                        UtilisateurRecord[]

  @@unique([siret, nom, adresse_id], map: "structure_ukey")
  @@map("structure")
  @@schema("main")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ifn_departement {
  id         Int       @id @default(autoincrement())
  code       String    @unique(map: "ifn_departement_code_dept_unique") @db.VarChar(3)
  score      Decimal   @db.Decimal
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)

  @@index([code], map: "ifn_departement_code_dept_idx")
  @@schema("admin")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model contrat {
  id           Int       @id @default(autoincrement())
  personne_id  Int
  date_debut   DateTime? @db.Date
  date_fin     DateTime? @db.Date
  date_rupture DateTime? @db.Date
  type         String?   @db.VarChar(3)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @db.Timestamp(6)
  personne     personne  @relation(fields: [personne_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("main")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model formation {
  id               Int       @id @default(autoincrement())
  personne_id      Int
  label            String?   @db.VarChar(11)
  parcours         String?   @db.VarChar(4)
  lot              Int?      @db.SmallInt
  marche_formation String?   @db.VarChar(8)
  lieu             String?   @db.VarChar(255)
  date_debut       DateTime? @db.Date
  date_fin         DateTime? @db.Date
  pix              Boolean?
  remn             Boolean?
  observations     String?
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @db.Timestamp(6)
  personne         personne  @relation(fields: [personne_id], references: [id], onDelete: Cascade)

  @@index([personne_id])
  @@schema("main")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model subvention {
  id                                Int       @id @default(autoincrement())
  poste_id                          Int
  source_financement                String?   @db.VarChar(4)
  date_debut_convention             DateTime? @db.Date
  date_debut_financement            DateTime? @db.Date
  date_fin_convention               DateTime? @db.Date
  date_fin_financement              DateTime? @db.Date
  montant_subvention                BigInt?
  montant_bonification              BigInt?
  versement_1                       BigInt?
  versement_2                       BigInt?
  versement_3                       BigInt?
  date_versement_1                  DateTime? @db.Date
  date_versement_2                  DateTime? @db.Date
  date_versement_3                  DateTime? @db.Date
  is_territoire_prioritaire         Boolean?
  mois_utilises_periode_financement Int?      @db.SmallInt
  mois_utilises_poste               Int?      @db.SmallInt
  created_at                        DateTime? @default(now()) @db.Timestamp(6)
  updated_at                        DateTime? @db.Timestamp(6)
  avoir                             BigInt?
  cp_a_date                         BigInt?
  poste                             poste     @relation(fields: [poste_id], references: [id], onDelete: Cascade)

  @@schema("main")
}

model naf {
  id             Int       @id @default(autoincrement())
  code           String    @unique(map: "naf_ukey") @db.VarChar(6)
  intitule_long  String    @db.VarChar(150)
  intitule_court String    @db.VarChar(65)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @db.Timestamp(6)

  @@schema("reference")
}

model categories_juridiques {
  id         Int              @id @default(autoincrement())
  code       String           @unique(map: "categories_juridiques_ukey") @db.VarChar(4)
  nom        String           @db.VarChar(150)
  niveau     Int              @db.SmallInt
  created_at DateTime?        @default(now()) @db.Timestamp(6)
  updated_at DateTime?        @db.Timestamp(6)
  structure  main_structure[]

  @@schema("reference")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model personne_affectations {
  id                Int             @id @default(autoincrement())
  personne_id       Int
  structure_id      Int?
  structure_coop_id String?         @db.Uuid
  mediateur_coop_id String?         @db.Uuid
  type              String          @db.VarChar
  suppression       DateTime?       @db.Timestamptz(6)
  created_at        DateTime?       @default(now()) @db.Timestamp(6)
  updated_at        DateTime?       @db.Timestamp(6)
  personne          personne        @relation(fields: [personne_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  structure         main_structure? @relation(fields: [structure_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([personne_id], map: "idx_personne_affectations_personne_id")
  @@index([structure_id], map: "idx_personne_affectations_structure_id")
  @@schema("main")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model icp_departement {
  id         Int       @id @default(autoincrement())
  code       String    @unique(map: "icp_departement_code_ukey") @db.VarChar(3)
  label      String?   @db.VarChar
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)

  @@schema("admin")
}
